apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ .Values.postgresql.fullnameOverride }}-extended-config"
data:
  override.conf: |
    # any config options list here will the override the default value 
    # in the default conf file (/opt/bitnami/postgresql/conf/postgresql.conf) in the docker image
{{- if .Values.backupRestore.backup.enabled }}
    wal_level = '{{ .Values.backupRestore.backup.walLevel | default "replica" }}'
    archive_mode = 'on'
    archive_command = '/usr/local/bin/wal-e wal-push $PGDATA/%p'
    archive_timeout = {{ .Values.backupRestore.backup.archiveTimeout | default 60 }}
{{- end }}
    # config options below are generated from .Values.config and will override any config above this line
{{- with .Values.config }}
{{- range $key, $value := . }}
    {{- if kindIs "string" $value }}
    {{ $key | snakecase }} = '{{ $value }}'
    {{- else }}
    {{ $key | snakecase }} = {{ $value }}
    {{- end }}
{{- end }}
    